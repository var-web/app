<!DOCTYPE html>    
<html lang="ar">    
<head>    
  <meta charset="UTF-8" />    
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>    
  <title>VAR</title>    
  <style>    
    body {    
      margin: 0;    
      background: #121212;    
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;    
      color: #f1f1f1;    
      user-select: none;    
    }    
    * {    
      -webkit-user-select: none;    
      -moz-user-select: none;    
      -ms-user-select: none;    
      -webkit-tap-highlight-color: transparent;    
    }    
    header {    
      padding: 25px;    
      text-align: center;    
      background: #1a1a1a;    
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);    
    }    
    header h1 {    
      margin: 0;    
      font-size: 2em;    
      color: #00bcd4;    
      letter-spacing: 2px;    
    }    
    #shareGate {    
      text-align: center;    
      padding: 40px 20px;    
      display: flex;    
      flex-direction: column;    
      align-items: center;    
      justify-content: center;    
      height: 80vh;    
    }    
    .share-btn {    
      display: inline-block;    
      margin: 10px;    
      padding: 12px 22px;    
      font-size: 1em;    
      border: none;    
      border-radius: 8px;    
      font-weight: 500;    
      cursor: pointer;    
      transition: background 0.3s ease, transform 0.2s ease;    
    }    
    .whatsapp { background: #2e2e2e; color: #25d366; }    
    .telegram { background: #2e2e2e; color: #0088cc; }    
    .native-share { background: #2e2e2e; color: #00bcd4; }    
    .share-btn:hover { background: #333; transform: translateY(-2px); }    
    #feedback { margin-top: 20px; font-size: 1em; color: #cccccc; }    
    #confirmEnter {    
      margin-top: 25px;    
      padding: 10px 22px;    
      background: #00bcd4;    
      border: none;    
      border-radius: 6px;    
      font-size: 1em;    
      color: #fff;    
      font-weight: bold;    
      cursor: pointer;    
      display: none;    
    }    
    #channelList {    
      display: none;    
      padding: 20px;    
      display: grid;    
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));    
      gap: 20px;    
    }    
    .channel {    
      background: #1e1e1e;    
      padding: 20px;    
      border-radius: 10px;    
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);    
      cursor: pointer;    
      text-align: center;    
    }    
    .channel span { font-size: 1.1em; color: #fff; font-weight: 500; }    
    .channel:hover { background: #2a2a2a; }    
    #overlay, #playerPopup {    
      display: none;    
      position: fixed;    
      top: 0;    
      left: 0;    
      width: 100%;    
      height: 100%;    
      z-index: 1000;    
    }    
    #overlay { background: rgba(0, 0, 0, 0.8); }    
    #playerPopup { background: black; z-index: 1001; }    
    #playerPopup video {    
      width: 100%;    
      height: 100%;    
      object-fit: contain;    
    }    
    @media screen and (orientation: landscape) {    
      #playerPopup video { object-fit: fill; }    
    }    
    #popupContainer {    
      position: fixed;    
      top: 0;    
      left: 0;    
      width: 100%;    
      height: 100%;    
      background-color: rgba(0,0,0,0.8);    
      display: none;    
      align-items: center;    
      justify-content: center;    
      z-index: 2000;    
    }    
    #popupBox {    
      position: relative;    
      width: 90%;    
      max-width: 600px;    
      height: 80%;    
      background: #1e1e1e;    
      border-radius: 10px;    
      overflow: hidden;    
    }    
    #popupBox::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      z-index: 5;
      pointer-events: none;
    }
    #popupBox iframe { 
      width: 100%; 
      height: 100%; 
      border: none; 
      position: relative; 
      z-index: 1;
    }    
    #closePopup {    
      position: absolute;    
      top: 8px;    
      right: 12px;    
      font-size: 55px;    
      color: red;    
      cursor: pointer;    
      z-index: 10;    
    }    
  </style>    
</head>    
<body>    
  
  <div id="shareGate">    
    <p>يرجى مشاركة رابط تطبيق ڤار لتلاث أشخاص عبر واتساب او تلغرام لتتمكن من الدخول</p>    
    <div id="shareButtons"></div>    
    <div id="feedback"></div>    
    <button id="confirmEnter" onclick="allowEntry()">الدخول الآن</button>    
  </div>    
  
  <div id="channelList"></div>    
  <div id="overlay" onclick="closePlayer()"></div>    
  <div id="playerPopup" onclick="closePlayer()">    
    <video id="videoPlayer" autoplay playsinline></video>    
  </div>    
  
  <div id="popupContainer">    
    <div id="popupBox">    
      <span id="closePopup" onclick="document.getElementById('popupContainer').style.display='none'">&times;</span>    
      <iframe src="https://www.profitableratecpm.com/e1r7gz70wx?key=c59bdf5dd8b1ff70073480a900b9e825"></iframe>    
    </div>    
  </div>    
  
  <script>    
    const shareText = "أفضل تطبيق لمشاهدة المباريات المباشرة و القديمة : https://apkpure.com/var/var.apliclca/downloading";    
    const message = encodeURIComponent(shareText);    
    const m3uUrl = "https://m3u.ch/pl/4d85b29c87b424bd486db25f2249a357_13ba9be7da20c71fa6082e74d7091e20.m3u";    
    const channelList = document.getElementById("channelList");    
    const videoPlayer = document.getElementById("videoPlayer");    
    const playerPopup = document.getElementById("playerPopup");    
    const overlay = document.getElementById("overlay");    
    const shareButtons = document.getElementById("shareButtons");    
    let clickTime = 0;    
    
    function createShareButtons() {    
      if (navigator.share) {    
        const btn = document.createElement("button");    
        btn.className = "share-btn native-share";    
        btn.textContent = "مشاركة الرابط";    
        btn.onclick = async () => {    
          clickTime = Date.now();    
          try {    
            await navigator.share({ text: shareText });    
          } catch (err) {    
            window.open(`https://wa.me/?text=${message}`, '_blank');    
            setTimeout(() => window.open(`https://t.me/share/url?url=${message}`, '_blank'), 1000);    
          }    
        };    
        shareButtons.appendChild(btn);    
      } else {    
        const btnWA = document.createElement("button");    
        btnWA.className = "share-btn whatsapp";    
        btnWA.textContent = "مشاركة واتساب";    
        btnWA.onclick = () => {    
          clickTime = Date.now();    
          window.open(`https://wa.me/?text=${message}`, '_blank');    
        };    
    
        const btnTG = document.createElement("button");    
        btnTG.className = "share-btn telegram";    
        btnTG.textContent = "مشاركة تيليجرام";    
        btnTG.onclick = () => {    
          clickTime = Date.now();    
          window.open(`https://t.me/share/url?url=${message}`, '_blank');    
        };    
        shareButtons.appendChild(btnWA);    
        shareButtons.appendChild(btnTG);    
      }    
    }    
    
    document.addEventListener('visibilitychange', () => {    
      if (document.visibilityState === 'visible' && clickTime > 0) {    
        const diff = (Date.now() - clickTime) / 1000;    
        const feedback = document.getElementById("feedback");    
        const confirmBtn = document.getElementById("confirmEnter");    
    
        if (diff < 10) {    
          feedback.textContent = "يبدو أنك لم ترسل الرابط، حاول مرة أخرى.";    
          confirmBtn.style.display = "none";    
        } else {    
          feedback.textContent = "تمت المشاركة بنجاح اضغط على الزر للدخول.";    
          confirmBtn.style.display = "inline-block";    
        }    
        clickTime = 0;    
      }    
    });    
    
    function allowEntry() {    
      document.getElementById("shareGate").style.display = "none";    
      channelList.style.display = "grid";    
      loadChannels();    
    }    
    
    async function loadChannels() {    
      try {    
        const res = await fetch(m3uUrl);    
        const text = await res.text();    
        const lines = text.split("\n");    
        let channels = [];    
    
        for (let i = 0; i < lines.length; i++) {    
          if (lines[i].startsWith("#EXTINF")) {    
            const name = lines[i].split(",")[1] || "قناة";    
            const url = lines[i + 1];    
            if (url && url.startsWith("http")) {    
              channels.push({ name, url });    
            }    
          }    
        }    
    
        channelList.innerHTML = "";    
        channels.forEach(ch => {    
          const div = document.createElement("div");    
          div.className = "channel";    
          div.innerHTML = `<span>${ch.name}</span>`;    
          div.onclick = () => {    
            videoPlayer.pause();    
            videoPlayer.src = ch.url;    
            videoPlayer.muted = false;    
            videoPlayer.autoplay = true;    
            playerPopup.style.display = "block";    
            overlay.style.display = "block";    
            videoPlayer.load();    
            videoPlayer.play().catch(e => console.log("خطأ تشغيل:", e));    
  
            if (videoPlayer.requestFullscreen) {
              videoPlayer.requestFullscreen();
            } else if (videoPlayer.webkitRequestFullscreen) {
              videoPlayer.webkitRequestFullscreen();
            } else if (videoPlayer.msRequestFullscreen) {
              videoPlayer.msRequestFullscreen();
            }
          };    
          channelList.appendChild(div);    
        });    
      } catch (err) {    
        channelList.innerHTML = "<p style='color: red;'>تعذر تحميل القنوات حالياً.</p>";    
        console.error(err);    
      }    
    }    
    
    function closePlayer() {    
      videoPlayer.pause();    
      videoPlayer.src = "";    
      playerPopup.style.display = "none";    
      overlay.style.display = "none";    
    }    
    
    window.addEventListener('load', () => {    
      createShareButtons();    
      setTimeout(() => {    
        document.getElementById('popupContainer').style.display = 'flex';    
      }, 1000);    
    });    
  </script>    
</body>    
</html>
